---
phase: 08-automation-workflows
plan: 06
type: execute
wave: 3
depends_on: ["08-05"]
files_modified:
  - frontend/src/components/workflow/WorkflowSidebar.tsx
  - frontend/src/components/workflow/WorkflowToolbar.tsx
  - frontend/src/components/workflow/NodeConfigPanel.tsx
  - frontend/src/components/workflow/WorkflowTestMode.tsx
  - frontend/src/pages/WorkflowBuilderPage.tsx
autonomous: true

must_haves:
  truths:
    - "User can drag nodes from sidebar to canvas"
    - "User can configure nodes via panel"
    - "User can test workflow with sample data"
    - "User can save, toggle, export workflow from toolbar"
  artifacts:
    - path: "frontend/src/pages/WorkflowBuilderPage.tsx"
      provides: "Visual workflow builder page"
      min_lines: 150
    - path: "frontend/src/components/workflow/WorkflowSidebar.tsx"
      provides: "Node palette for dragging"
      min_lines: 80
    - path: "frontend/src/components/workflow/NodeConfigPanel.tsx"
      provides: "Configuration panel for selected node"
      min_lines: 100
    - path: "frontend/src/components/workflow/WorkflowTestMode.tsx"
      provides: "Test execution preview"
      min_lines: 80
  key_links:
    - from: "frontend/src/pages/WorkflowBuilderPage.tsx"
      to: "frontend/src/components/workflow/WorkflowCanvas.tsx"
      via: "Renders canvas"
      pattern: "WorkflowCanvas"
    - from: "frontend/src/components/workflow/NodeConfigPanel.tsx"
      to: "frontend/src/hooks/useWorkflows.ts"
      via: "Updates workflow"
      pattern: "useUpdateWorkflow"
---

<objective>
Create the complete workflow builder page with sidebar, toolbar, configuration panel, and test mode.

Purpose: Enable users to visually create and configure workflows with drag-and-drop interface.

Output: WorkflowBuilderPage with sidebar palette, node configuration, toolbar actions, test mode preview.
</objective>

<execution_context>
@/Users/tvellore/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tvellore/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/08-automation-workflows/08-CONTEXT.md
@.planning/phases/08-automation-workflows/08-RESEARCH.md
@.planning/phases/08-automation-workflows/08-05-SUMMARY.md

# Existing UI patterns
@frontend/src/pages/DashboardPage.tsx
@frontend/src/components/ui/dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WorkflowSidebar and WorkflowToolbar</name>
  <files>frontend/src/components/workflow/WorkflowSidebar.tsx, frontend/src/components/workflow/WorkflowToolbar.tsx</files>
  <action>
Create frontend/src/components/workflow/WorkflowSidebar.tsx:

1. Node palette with draggable items (per user decision - visual drag-and-drop):
   ```tsx
   interface SidebarProps {
     onStartFromTemplate?: () => void;  // Per user decision - template library on creation
   }
   ```

2. Sections:
   - **Triggers** (one per workflow - shown disabled if trigger exists):
     - Incident Created
     - State Changed
     - Escalation Occurred
     - Manual Trigger
     - Incident Age
   - **Actions:**
     - HTTP Webhook
     - Create Jira Ticket
     - Create Linear Issue
   - **Flow Control:**
     - Condition (If/Else)
     - Delay

3. Each item is draggable:
   - Use HTML5 drag API or React DnD
   - Set dataTransfer with node type
   - Visual feedback on drag

4. Button at top: "Start from Template" (per user decision)

5. Show helpful tooltips on hover

---

Create frontend/src/components/workflow/WorkflowToolbar.tsx:

1. Props:
   ```tsx
   interface ToolbarProps {
     workflow: Workflow;
     isDirty: boolean;
     onSave: () => void;
     onTest: () => void;
     onExport: () => void;
     onToggle: () => void;
     isValidating: boolean;
     validationErrors: string[];
   }
   ```

2. Actions:
   - **Save** button (disabled if not dirty or has errors)
   - **Test** button to open test mode (per user decision)
   - **Toggle** switch for enabled/disabled (per user decision)
   - **Export** dropdown: Export JSON, Duplicate (per user decision)
   - **Version History** button to view versions (per user decision)

3. Real-time validation feedback (per user decision):
   - Show error count badge if validationErrors.length > 0
   - Popover with error list on click

4. Workflow metadata display:
   - Name (editable inline)
   - Version number
   - Last saved timestamp
  </action>
  <verify>cd frontend && npx tsc --noEmit</verify>
  <done>Sidebar with draggable nodes, toolbar with save/test/export/toggle</done>
</task>

<task type="auto">
  <name>Task 2: Create NodeConfigPanel for editing nodes</name>
  <files>frontend/src/components/workflow/NodeConfigPanel.tsx</files>
  <action>
Create frontend/src/components/workflow/NodeConfigPanel.tsx:

1. Props:
   ```tsx
   interface NodeConfigPanelProps {
     selectedNode: Node | null;
     onChange: (nodeId: string, data: any) => void;
   }
   ```

2. Render different forms based on node type:

**TriggerConfig:**
- Dropdown for trigger type
- Conditions editor (add/remove conditions per user decision - simple field matching):
  - Field dropdown: priority, status, service, metadata.service
  - Value input
- For 'age' trigger: threshold minutes input
- For 'state_changed': from/to state dropdowns

**ActionConfig (webhook):**
- URL input with template preview (per user decision - {{variable}} syntax)
- Method dropdown (POST/PUT/PATCH)
- Headers key-value editor
- Body textarea with JSON validation
- Auth section:
  - Type dropdown (none, bearer, basic, oauth2, custom per user decision)
  - Conditional fields based on auth type
- Retry config: attempts, initial delay

**ActionConfig (jira):**
- Project key input
- Issue type dropdown
- Summary input (template)
- Description textarea (template)
- Priority dropdown
- Labels multi-select

**ActionConfig (linear):**
- Team ID input
- Title input (template)
- Description textarea (template)
- Priority dropdown (0-4)
- Labels multi-select

**ConditionConfig:**
- Field input/dropdown
- Value input
- Preview of true/false paths

**DelayConfig:**
- Duration input (minutes)
- Presets: 1min, 5min, 15min, 30min, 1hr

3. Real-time validation (per user decision):
   - Highlight invalid fields with red border
   - Show error message below field
   - Mark required fields with asterisk

4. Template variable helper:
   - Show available variables: {{incident.title}}, {{incident.priority}}, etc.
   - Insert variable on click
  </action>
  <verify>cd frontend && npx tsc --noEmit</verify>
  <done>NodeConfigPanel renders appropriate form for each node type with validation</done>
</task>

<task type="auto">
  <name>Task 3: Create WorkflowTestMode and WorkflowBuilderPage</name>
  <files>frontend/src/components/workflow/WorkflowTestMode.tsx, frontend/src/pages/WorkflowBuilderPage.tsx</files>
  <action>
Create frontend/src/components/workflow/WorkflowTestMode.tsx:

1. Props:
   ```tsx
   interface TestModeProps {
     workflow: Workflow;
     isOpen: boolean;
     onClose: () => void;
   }
   ```

2. Test mode panel (per user decision - test with sample data):
   - Select incident dropdown (from recent incidents) OR
   - Use sample data form:
     - Incident title, priority, status, service
     - Team name
     - Assignee email

3. Two test modes (per research recommendation):
   - **Dry Run**: Show interpolated values without executing
     - Display what each webhook URL/body would be
     - Show what ticket fields would contain
   - **Live Test**: Actually execute with real APIs
     - Mark executions as test in analytics
     - Show real responses

4. Results display:
   - Step-by-step execution preview
   - Show interpolated templates
   - For live test: show success/failure status

---

Create frontend/src/pages/WorkflowBuilderPage.tsx:

1. Route: /workflows/new or /workflows/:id/edit

2. Layout (3-column):
   - Left: WorkflowSidebar (collapsible)
   - Center: WorkflowCanvas
   - Right: NodeConfigPanel (shows when node selected)

3. State management:
   - Load workflow if editing (useWorkflow hook)
   - Track unsaved changes (isDirty)
   - Selected node state
   - Validation state

4. Handle drag-and-drop:
   - onDrop handler for canvas
   - Create new node at drop position
   - Auto-layout after adding node

5. Workflow metadata editing:
   - Name and description in header (per user decision - required)
   - Scope selector (team/global)
   - Team selector (if team-scoped)

6. Auto-save or save button:
   - Show "Unsaved changes" indicator
   - Save creates new version (per user decision)

7. Template starter flow (per user decision):
   - When creating new, show template dialog first
   - Templates organized by category
   - Can skip to blank workflow

8. Exit confirmation if unsaved changes

9. WorkflowToolbar at top

10. WorkflowTestMode as dialog/drawer
  </action>
  <verify>cd frontend && npx tsc --noEmit</verify>
  <done>Complete workflow builder page with sidebar, canvas, config panel, test mode</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` compiles frontend
2. Can drag nodes from sidebar to canvas
3. Selecting node shows config panel
4. Can configure all node types
5. Test mode shows interpolated values
6. Save creates new version
7. Export produces valid JSON
</verification>

<success_criteria>
- Visual drag-and-drop builder per user decision
- Template library on workflow creation per user decision
- Real-time validation feedback per user decision
- Test mode with sample data per user decision
- Toggle enabled/disabled per user decision
- JSON export per user decision
- Required name and description per user decision
- {{variable}} template syntax visible per user decision
</success_criteria>

<output>
After completion, create `.planning/phases/08-automation-workflows/08-06-SUMMARY.md`
</output>
