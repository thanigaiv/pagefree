---
phase: 08-automation-workflows
plan: 07
type: execute
wave: 4
depends_on: ["08-04", "08-06"]
files_modified:
  - frontend/src/pages/WorkflowsPage.tsx
  - frontend/src/components/workflow/WorkflowCard.tsx
  - frontend/src/components/workflow/WorkflowAnalytics.tsx
  - frontend/src/components/workflow/WorkflowTimeline.tsx
  - frontend/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can see list of workflows with status"
    - "User can view execution analytics"
    - "Workflow executions appear in incident timeline"
    - "Workflows accessible via navigation"
  artifacts:
    - path: "frontend/src/pages/WorkflowsPage.tsx"
      provides: "Workflow list page"
      min_lines: 100
    - path: "frontend/src/components/workflow/WorkflowAnalytics.tsx"
      provides: "Execution analytics display"
      min_lines: 60
    - path: "frontend/src/components/workflow/WorkflowTimeline.tsx"
      provides: "Grouped timeline entries"
      min_lines: 80
  key_links:
    - from: "frontend/src/pages/WorkflowsPage.tsx"
      to: "frontend/src/hooks/useWorkflows.ts"
      via: "useWorkflows hook"
      pattern: "useWorkflows"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/pages/WorkflowsPage.tsx"
      via: "Route registration"
      pattern: "WorkflowsPage"
    - from: "frontend/src/components/IncidentTimeline.tsx"
      to: "frontend/src/components/workflow/WorkflowTimeline.tsx"
      via: "Render grouped workflow events"
      pattern: "WorkflowTimelineEntry"
---

<objective>
Create workflow list page, analytics display, timeline integration, and routing.

Purpose: Enable users to manage workflows from a central page and see workflow executions in incident timelines.

Output: WorkflowsPage, WorkflowAnalytics, WorkflowTimeline component, navigation integration.
</objective>

<execution_context>
@/Users/tvellore/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tvellore/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/08-automation-workflows/08-CONTEXT.md
@.planning/phases/08-automation-workflows/08-RESEARCH.md
@.planning/phases/08-automation-workflows/08-06-SUMMARY.md

# Existing patterns
@frontend/src/pages/IntegrationsPage.tsx
@frontend/src/components/IncidentTimeline.tsx
@frontend/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WorkflowsPage and WorkflowCard</name>
  <files>frontend/src/pages/WorkflowsPage.tsx, frontend/src/components/workflow/WorkflowCard.tsx</files>
  <action>
Create frontend/src/components/workflow/WorkflowCard.tsx:

1. Props:
   ```tsx
   interface WorkflowCardProps {
     workflow: Workflow;
     onEdit: () => void;
     onDuplicate: () => void;
     onDelete: () => void;
     onToggle: () => void;
   }
   ```

2. Display:
   - Name and description
   - Scope badge (Team/Global)
   - Status indicator (Enabled/Disabled) with toggle switch (per user decision)
   - Trigger type icon and label
   - Quick stats: execution count, success rate (per user decision - analytics)
   - Last executed timestamp
   - Action dropdown: Edit, Duplicate, Export, Delete (per user decision)

3. Visual states:
   - Enabled: normal colors
   - Disabled: muted/grayed out
   - Highlight on hover

4. Show team name for team-scoped workflows

---

Create frontend/src/pages/WorkflowsPage.tsx:

1. Route: /workflows

2. Header:
   - Title: "Workflows"
   - "Create Workflow" button (links to /workflows/new)
   - Template button: "Browse Templates" (per user decision)

3. Filters:
   - Scope: All, Team, Global
   - Status: All, Enabled, Disabled
   - Team selector (if user has multiple teams)
   - Search by name (per user decision - template search/filter applies here too)

4. Main content:
   - Grid of WorkflowCards (responsive: 1 col mobile, 2 col tablet, 3 col desktop)
   - Empty state if no workflows: "No workflows yet. Create one to automate incident response."
   - Loading skeletons

5. Template Library tab/section (per user decision - template library):
   - Category filters: Ticketing, Communication, Auto-resolution
   - Template cards with "Use Template" button
   - Search templates

6. Pagination or infinite scroll

7. Permissions:
   - Show only workflows user can access
   - Global workflows visible to all
   - Team workflows visible to team members
   - Create button requires team admin or platform admin

8. Version indicator (per user decision):
   - Show "v{version}" on card
   - Click to view version history
  </action>
  <verify>cd frontend && npx tsc --noEmit</verify>
  <done>WorkflowsPage lists all accessible workflows with filters and template library</done>
</task>

<task type="auto">
  <name>Task 2: Create WorkflowAnalytics and VersionHistory</name>
  <files>frontend/src/components/workflow/WorkflowAnalytics.tsx, frontend/src/components/workflow/VersionHistory.tsx</files>
  <action>
Create frontend/src/components/workflow/WorkflowAnalytics.tsx:

Per user decision - detailed execution analytics showing execution count, success rate, average duration, failure points:

1. Props:
   ```tsx
   interface WorkflowAnalyticsProps {
     workflowId: string;
   }
   ```

2. Use useWorkflowAnalytics hook to fetch data

3. Display metrics:
   - **Execution Count**: Total runs in period (30 days default)
   - **Success Rate**: Percentage completed successfully
   - **Average Duration**: Mean execution time
   - **Failure Points**: Which actions fail most often

4. Visualizations:
   - Success/Failure pie chart (simple)
   - Execution trend line (executions per day)
   - Failure breakdown by action type

5. Time range selector: Last 7 days, 30 days, 90 days

6. Recent executions list:
   - Status, duration, trigger event
   - Link to incident
   - Expandable to show action results

---

Create frontend/src/components/workflow/VersionHistory.tsx:

Per user decision - full version history with rollback:

1. Props:
   ```tsx
   interface VersionHistoryProps {
     workflowId: string;
     currentVersion: number;
     onRollback: (version: number) => void;
   }
   ```

2. Use useWorkflowVersions hook

3. Display version list:
   - Version number
   - Changed by (user name)
   - Change note (if provided)
   - Timestamp
   - "Rollback" button (per user decision)

4. Version diff viewer (optional - show what changed)

5. Highlight current version

6. Rollback confirmation dialog:
   - "This will create a new version based on v{n}"
   - Confirm/Cancel
  </action>
  <verify>cd frontend && npx tsc --noEmit</verify>
  <done>Analytics shows execution metrics, version history supports rollback</done>
</task>

<task type="auto">
  <name>Task 3: Create WorkflowTimeline and integrate routes</name>
  <files>frontend/src/components/workflow/WorkflowTimeline.tsx, frontend/src/components/IncidentTimeline.tsx, frontend/src/App.tsx</files>
  <action>
Create frontend/src/components/workflow/WorkflowTimeline.tsx:

Per user decision - grouped timeline entries with visual nesting (per research pattern):

1. Props:
   ```tsx
   interface WorkflowTimelineEntryProps {
     execution: {
       executionId: string;
       workflowName: string;
       status: 'running' | 'completed' | 'failed';
       startedAt: string;
       completedAt?: string;
       actions: ActionEntry[];
     };
   }
   ```

2. Collapsible parent entry:
   - Workflow name
   - Status icon (spinner for running, check for completed, X for failed)
   - Duration or "Running..."
   - Chevron to expand/collapse

3. Nested action entries (when expanded):
   - Action name and type
   - Status icon
   - Result preview (ticket URL clickable, webhook status code)
   - Error message if failed

4. Auto-expand if status is 'running' or 'failed'

5. Color coding:
   - Running: blue
   - Completed: green
   - Failed: red

---

Update frontend/src/components/IncidentTimeline.tsx:

1. Import WorkflowTimelineEntry component

2. Detect workflow execution audit events:
   - action: 'workflow.execution.started'
   - action: 'workflow.execution.completed'
   - action: 'workflow.action.completed'
   - action: 'workflow.action.failed'

3. Group workflow events by executionId using groupWorkflowEvents helper:
   ```typescript
   interface ExecutionGroup {
     executionId: string;
     workflowName: string;
     status: 'running' | 'completed' | 'failed';
     startedAt: string;
     completedAt?: string;
     actions: ActionEntry[];
   }

   function groupWorkflowEvents(events: TimelineEvent[]): ExecutionGroup[] {
     // 1. Filter events to workflow.* actions only
     const workflowEvents = events.filter(e =>
       e.action.startsWith('workflow.')
     );

     // 2. Group by metadata.executionId
     const groupedById = new Map<string, TimelineEvent[]>();
     for (const event of workflowEvents) {
       const execId = event.metadata?.executionId;
       if (!execId) continue;
       if (!groupedById.has(execId)) {
         groupedById.set(execId, []);
       }
       groupedById.get(execId)!.push(event);
     }

     // 3. Transform each group into ExecutionGroup
     const groups: ExecutionGroup[] = [];
     for (const [executionId, groupEvents] of groupedById) {
       // Sort by timestamp ascending
       groupEvents.sort((a, b) =>
         new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime()
       );

       // Find start event for workflow name
       const startEvent = groupEvents.find(e =>
         e.action === 'workflow.execution.started'
       );

       // Find completion/failure event for status
       const completedEvent = groupEvents.find(e =>
         e.action === 'workflow.execution.completed'
       );
       const failedEvent = groupEvents.find(e =>
         e.action === 'workflow.execution.failed'
       );

       // Determine status
       let status: 'running' | 'completed' | 'failed' = 'running';
       if (completedEvent) status = 'completed';
       if (failedEvent) status = 'failed';

       // Extract action entries
       const actions: ActionEntry[] = groupEvents
         .filter(e => e.action.includes('.action.'))
         .map(e => ({
           name: e.metadata?.actionName || 'Unknown',
           type: e.metadata?.actionType || 'unknown',
           status: e.action.includes('completed') ? 'completed' : 'failed',
           result: e.metadata?.result,
           error: e.metadata?.error,
           timestamp: e.timestamp
         }));

       groups.push({
         executionId,
         workflowName: startEvent?.metadata?.workflowName || 'Workflow',
         status,
         startedAt: startEvent?.timestamp || groupEvents[0].timestamp,
         completedAt: completedEvent?.timestamp || failedEvent?.timestamp,
         actions
       });
     }

     // 4. Sort groups by startedAt descending (most recent first)
     return groups.sort((a, b) =>
       new Date(b.startedAt).getTime() - new Date(a.startedAt).getTime()
     );
   }
   ```

4. Render WorkflowTimelineEntry for each grouped execution:
   ```tsx
   const workflowGroups = useMemo(() =>
     groupWorkflowEvents(timelineEvents),
     [timelineEvents]
   );

   // In render, for workflow events, render grouped entries
   // For non-workflow events, render standard timeline entries
   ```

5. Keep existing non-workflow events as-is (don't group them)

---

Update frontend/src/App.tsx:

1. Add routes:
   - /workflows -> WorkflowsPage
   - /workflows/new -> WorkflowBuilderPage
   - /workflows/:id -> WorkflowBuilderPage (view/edit)
   - /workflows/:id/analytics -> WorkflowAnalytics (or as tab in builder)

2. Add "Workflows" to navigation (sidebar or header)

3. Protect routes with auth

4. Add breadcrumbs for workflow pages
  </action>
  <verify>cd frontend && npx tsc --noEmit</verify>
  <done>Workflow timeline shows grouped executions in incident detail, routes registered in App</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` compiles frontend
2. /workflows page shows workflow list with filters
3. Template library visible with categories
4. Analytics shows execution metrics
5. Version history allows rollback
6. Incident timeline shows grouped workflow executions
7. Navigation includes Workflows link
</verification>

<success_criteria>
- Workflow list with scope and status filters
- Template library organized by categories per user decision
- Detailed execution analytics per user decision
- Full version history with rollback per user decision
- Grouped timeline entries per user decision
- Workflow duplication from list per user decision
- Navigation to workflow pages
</success_criteria>

<output>
After completion, create `.planning/phases/08-automation-workflows/08-07-SUMMARY.md`
</output>
