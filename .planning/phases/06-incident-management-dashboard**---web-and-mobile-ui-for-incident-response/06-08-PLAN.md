---
phase: 06-incident-management-dashboard
plan: 08
type: execute
wave: 4
depends_on: ["06-07"]
files_modified:
  - frontend/src/hooks/useSwipeGesture.ts
  - frontend/src/components/SwipeableRow.tsx
  - frontend/src/components/BottomNav.tsx
  - frontend/src/components/MobileLayout.tsx
  - frontend/src/pages/SchedulePage.tsx
  - frontend/src/pages/ProfilePage.tsx
  - frontend/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Mobile users can swipe right to acknowledge incidents"
    - "Mobile users can swipe left to see options menu"
    - "Bottom navigation bar shows on mobile screens"
    - "Mobile navigation uses full-screen transitions"
    - "Swipe gestures have visual feedback before committing"
  artifacts:
    - path: "frontend/src/hooks/useSwipeGesture.ts"
      provides: "Swipe detection hook"
      contains: "onSwipeRight"
    - path: "frontend/src/components/SwipeableRow.tsx"
      provides: "Swipeable incident row wrapper"
      contains: "swipeHandlers"
    - path: "frontend/src/components/BottomNav.tsx"
      provides: "Mobile bottom navigation"
      contains: "Incidents"
  key_links:
    - from: "frontend/src/components/SwipeableRow.tsx"
      to: "frontend/src/hooks/useSwipeGesture.ts"
      via: "useSwipeGesture hook"
      pattern: "useSwipeGesture"
    - from: "frontend/src/components/BottomNav.tsx"
      to: "react-router-dom"
      via: "NavLink navigation"
      pattern: "NavLink|Link"
---

<objective>
Implement mobile-specific gestures and navigation for PWA experience.

Purpose: Make incident response fast on mobile with thumb-friendly navigation and swipe gestures. Per user decisions: swipe right to acknowledge, swipe left for options, bottom nav bar (Incidents, Schedule, Profile), full-screen transitions.

Output: Mobile-optimized UI with swipe gestures and bottom navigation.
</objective>

<execution_context>
@/Users/tvellore/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tvellore/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-incident-management-dashboard**---web-and-mobile-ui-for-incident-response/06-CONTEXT.md
@.planning/phases/06-incident-management-dashboard**---web-and-mobile-ui-for-incident-response/06-RESEARCH.md
@.planning/phases/06-incident-management-dashboard**---web-and-mobile-ui-for-incident-response/06-07-SUMMARY.md

# Incident row component
@frontend/src/components/IncidentRow.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Swipe Gesture Hook</name>
  <files>
    frontend/src/hooks/useSwipeGesture.ts
    frontend/src/hooks/useMediaQuery.ts
  </files>
  <action>
Create frontend/src/hooks/useMediaQuery.ts:
```typescript
import { useState, useEffect } from 'react';

export function useMediaQuery(query: string): boolean {
  const [matches, setMatches] = useState(() => {
    if (typeof window !== 'undefined') {
      return window.matchMedia(query).matches;
    }
    return false;
  });

  useEffect(() => {
    const mediaQuery = window.matchMedia(query);

    const handler = (e: MediaQueryListEvent) => setMatches(e.matches);

    // Modern browsers
    mediaQuery.addEventListener('change', handler);

    return () => mediaQuery.removeEventListener('change', handler);
  }, [query]);

  return matches;
}

// Common breakpoints
export function useIsMobile(): boolean {
  return useMediaQuery('(max-width: 768px)');
}

export function useIsTablet(): boolean {
  return useMediaQuery('(min-width: 769px) and (max-width: 1024px)');
}

export function useIsDesktop(): boolean {
  return useMediaQuery('(min-width: 1025px)');
}
```

Create frontend/src/hooks/useSwipeGesture.ts (per RESEARCH.md pattern with angle detection):
```typescript
import { useRef, useState, useCallback } from 'react';

interface SwipeHandlers {
  onSwipeRight?: () => void;
  onSwipeLeft?: () => void;
}

interface SwipeGestureResult {
  swipeHandlers: {
    onTouchStart: (e: React.TouchEvent) => void;
    onTouchMove: (e: React.TouchEvent) => void;
    onTouchEnd: () => void;
  };
  swipeOffset: number;
  isSwipingRight: boolean;
  isSwipingLeft: boolean;
  swipeDirection: 'left' | 'right' | null;
}

const MIN_SWIPE_DISTANCE = 80; // Minimum distance to trigger action
const PREVIEW_THRESHOLD = 30; // Show preview after 30px
const MAX_OFFSET = 100; // Maximum visual offset
const MIN_ANGLE = 30; // Minimum angle from horizontal (degrees)

export function useSwipeGesture(handlers: SwipeHandlers): SwipeGestureResult {
  const touchStartX = useRef<number | null>(null);
  const touchStartY = useRef<number | null>(null);
  const touchEndX = useRef<number | null>(null);
  const touchEndY = useRef<number | null>(null);
  const isHorizontalSwipe = useRef<boolean | null>(null);

  const [swipeOffset, setSwipeOffset] = useState(0);

  const onTouchStart = useCallback((e: React.TouchEvent) => {
    touchEndX.current = null;
    touchEndY.current = null;
    isHorizontalSwipe.current = null;
    touchStartX.current = e.targetTouches[0].clientX;
    touchStartY.current = e.targetTouches[0].clientY;
  }, []);

  const onTouchMove = useCallback((e: React.TouchEvent) => {
    touchEndX.current = e.targetTouches[0].clientX;
    touchEndY.current = e.targetTouches[0].clientY;

    if (
      touchStartX.current === null ||
      touchStartY.current === null ||
      touchEndX.current === null ||
      touchEndY.current === null
    ) {
      return;
    }

    const deltaX = touchEndX.current - touchStartX.current;
    const deltaY = touchEndY.current - touchStartY.current;

    // Determine if this is a horizontal swipe on first significant movement
    if (isHorizontalSwipe.current === null && (Math.abs(deltaX) > 10 || Math.abs(deltaY) > 10)) {
      // Calculate angle from horizontal
      const angle = Math.abs(Math.atan2(deltaY, deltaX) * (180 / Math.PI));

      // If angle is within MIN_ANGLE degrees of horizontal (0 or 180), it's a horizontal swipe
      isHorizontalSwipe.current = angle < MIN_ANGLE || angle > (180 - MIN_ANGLE);

      // If it's a vertical scroll, don't interfere
      if (!isHorizontalSwipe.current) {
        return;
      }
    }

    // Only track horizontal swipes
    if (isHorizontalSwipe.current) {
      // Prevent scroll while swiping (per RESEARCH.md pitfall #6)
      e.preventDefault();

      // Clamp offset for visual preview
      const clampedOffset = Math.max(-MAX_OFFSET, Math.min(MAX_OFFSET, deltaX));
      setSwipeOffset(clampedOffset);
    }
  }, []);

  const onTouchEnd = useCallback(() => {
    if (
      touchStartX.current === null ||
      touchEndX.current === null ||
      !isHorizontalSwipe.current
    ) {
      setSwipeOffset(0);
      touchStartX.current = null;
      touchStartY.current = null;
      isHorizontalSwipe.current = null;
      return;
    }

    const distance = touchEndX.current - touchStartX.current;

    // Trigger action if swipe was long enough
    if (distance > MIN_SWIPE_DISTANCE && handlers.onSwipeRight) {
      handlers.onSwipeRight();
    } else if (distance < -MIN_SWIPE_DISTANCE && handlers.onSwipeLeft) {
      handlers.onSwipeLeft();
    }

    // Reset
    setSwipeOffset(0);
    touchStartX.current = null;
    touchStartY.current = null;
    isHorizontalSwipe.current = null;
  }, [handlers]);

  const isSwipingRight = swipeOffset > PREVIEW_THRESHOLD;
  const isSwipingLeft = swipeOffset < -PREVIEW_THRESHOLD;
  const swipeDirection = isSwipingRight ? 'right' : isSwipingLeft ? 'left' : null;

  return {
    swipeHandlers: {
      onTouchStart,
      onTouchMove,
      onTouchEnd,
    },
    swipeOffset,
    isSwipingRight,
    isSwipingLeft,
    swipeDirection,
  };
}
```
  </action>
  <verify>
ls frontend/src/hooks/useSwipeGesture.ts
ls frontend/src/hooks/useMediaQuery.ts
cd frontend && npm run build
  </verify>
  <done>
Swipe gesture hook with angle detection to prevent conflicts with vertical scroll. Preview states for visual feedback. Media query hooks for responsive design.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SwipeableRow and Bottom Navigation</name>
  <files>
    frontend/src/components/SwipeableRow.tsx
    frontend/src/components/BottomNav.tsx
  </files>
  <action>
Create frontend/src/components/SwipeableRow.tsx:
```typescript
import { ReactNode } from 'react';
import { useSwipeGesture } from '@/hooks/useSwipeGesture';
import { useIsMobile } from '@/hooks/useMediaQuery';
import { cn } from '@/lib/utils';
import { Check, MoreHorizontal } from 'lucide-react';

interface SwipeableRowProps {
  children: ReactNode;
  onSwipeRight?: () => void;
  onSwipeLeft?: () => void;
  rightLabel?: string;
  leftLabel?: string;
  disabled?: boolean;
}

export function SwipeableRow({
  children,
  onSwipeRight,
  onSwipeLeft,
  rightLabel = 'Acknowledge',
  leftLabel = 'Options',
  disabled = false,
}: SwipeableRowProps) {
  const isMobile = useIsMobile();

  const { swipeHandlers, swipeOffset, isSwipingRight, isSwipingLeft } = useSwipeGesture({
    onSwipeRight: disabled ? undefined : onSwipeRight,
    onSwipeLeft: disabled ? undefined : onSwipeLeft,
  });

  // Don't enable swipe on desktop
  if (!isMobile) {
    return <>{children}</>;
  }

  return (
    <div className="relative overflow-hidden">
      {/* Background actions revealed by swipe */}
      <div className="absolute inset-0 flex">
        {/* Right swipe background (acknowledge) */}
        <div
          className={cn(
            'flex-1 flex items-center justify-start px-4 transition-colors',
            isSwipingRight ? 'bg-green-500' : 'bg-green-400'
          )}
        >
          <div className="flex items-center gap-2 text-white font-medium">
            <Check className="h-5 w-5" />
            <span>{rightLabel}</span>
          </div>
        </div>

        {/* Left swipe background (options) */}
        <div
          className={cn(
            'flex-1 flex items-center justify-end px-4 transition-colors',
            isSwipingLeft ? 'bg-gray-600' : 'bg-gray-500'
          )}
        >
          <div className="flex items-center gap-2 text-white font-medium">
            <span>{leftLabel}</span>
            <MoreHorizontal className="h-5 w-5" />
          </div>
        </div>
      </div>

      {/* Swipeable content */}
      <div
        {...swipeHandlers}
        className="relative bg-background transition-transform"
        style={{
          transform: `translateX(${swipeOffset}px)`,
        }}
      >
        {children}
      </div>
    </div>
  );
}
```

Create frontend/src/components/BottomNav.tsx (per user decision):
```typescript
import { NavLink } from 'react-router-dom';
import { useIsMobile } from '@/hooks/useMediaQuery';
import { cn } from '@/lib/utils';
import { AlertCircle, Calendar, User } from 'lucide-react';

const navItems = [
  {
    to: '/incidents',
    icon: AlertCircle,
    label: 'Incidents',
  },
  {
    to: '/schedule',
    icon: Calendar,
    label: 'Schedule',
  },
  {
    to: '/profile',
    icon: User,
    label: 'Profile',
  },
];

export function BottomNav() {
  const isMobile = useIsMobile();

  // Only show on mobile (per user decision)
  if (!isMobile) return null;

  return (
    <nav className="fixed bottom-0 left-0 right-0 bg-background border-t z-40 pb-safe">
      <div className="flex items-center justify-around h-16">
        {navItems.map((item) => (
          <NavLink
            key={item.to}
            to={item.to}
            className={({ isActive }) =>
              cn(
                'flex flex-col items-center justify-center flex-1 h-full',
                'text-muted-foreground transition-colors',
                isActive && 'text-primary'
              )
            }
          >
            {({ isActive }) => (
              <>
                <item.icon
                  className={cn(
                    'h-6 w-6',
                    isActive && 'text-primary'
                  )}
                />
                <span className="text-xs mt-1">{item.label}</span>
              </>
            )}
          </NavLink>
        ))}
      </div>
    </nav>
  );
}
```

Add padding for safe area (notch) in frontend/src/styles/globals.css:
```css
/* Add to existing globals.css */

/* Safe area padding for bottom nav on devices with notch */
.pb-safe {
  padding-bottom: env(safe-area-inset-bottom, 0);
}

/* Adjust main content for bottom nav on mobile */
@media (max-width: 768px) {
  main {
    padding-bottom: 5rem; /* 4rem nav + 1rem buffer */
  }
}
```
  </action>
  <verify>
ls frontend/src/components/SwipeableRow.tsx
ls frontend/src/components/BottomNav.tsx
cd frontend && npm run build
  </verify>
  <done>
SwipeableRow wrapper with visual feedback backgrounds. BottomNav with Incidents, Schedule, Profile tabs per user decision. Safe area padding for notched devices.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Mobile Layout and Placeholder Pages</name>
  <files>
    frontend/src/components/MobileLayout.tsx
    frontend/src/pages/SchedulePage.tsx
    frontend/src/pages/ProfilePage.tsx
    frontend/src/components/IncidentRow.tsx
    frontend/src/App.tsx
  </files>
  <action>
Create frontend/src/components/MobileLayout.tsx:
```typescript
import { ReactNode } from 'react';
import { BottomNav } from './BottomNav';
import { useIsMobile } from '@/hooks/useMediaQuery';

interface MobileLayoutProps {
  children: ReactNode;
}

export function MobileLayout({ children }: MobileLayoutProps) {
  const isMobile = useIsMobile();

  return (
    <div className="min-h-screen">
      <main className={isMobile ? 'pb-20' : ''}>
        {children}
      </main>
      <BottomNav />
    </div>
  );
}
```

Create frontend/src/pages/SchedulePage.tsx (placeholder per RESEARCH.md open question):
```typescript
import { Calendar } from 'lucide-react';

export default function SchedulePage() {
  return (
    <div className="container mx-auto py-6 px-4 max-w-4xl">
      <div className="flex flex-col items-center justify-center py-12 text-center">
        <Calendar className="h-16 w-16 text-muted-foreground mb-4" />
        <h1 className="text-2xl font-bold mb-2">Schedule</h1>
        <p className="text-muted-foreground max-w-md">
          View on-call schedules and rotations. This feature connects to the
          schedule management system built in Phase 3.
        </p>
        <p className="text-sm text-muted-foreground mt-4">
          Coming soon: View who's on-call, manage overrides, and swap shifts.
        </p>
      </div>
    </div>
  );
}
```

Create frontend/src/pages/ProfilePage.tsx (placeholder):
```typescript
import { User, Bell, Shield, Smartphone } from 'lucide-react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

export default function ProfilePage() {
  return (
    <div className="container mx-auto py-6 px-4 max-w-4xl">
      <h1 className="text-2xl font-bold mb-6">Profile</h1>

      <div className="space-y-4">
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <User className="h-5 w-5" />
              Account
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-muted-foreground">
              User profile information synced from Okta.
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Bell className="h-5 w-5" />
              Notification Preferences
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-muted-foreground">
              Configure email, SMS, push, and voice notifications.
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Smartphone className="h-5 w-5" />
              Mobile Settings
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-muted-foreground">
              Manage push notifications and biometric authentication.
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Shield className="h-5 w-5" />
              Security
            </CardTitle>
          </CardHeader>
          <CardContent>
            <p className="text-muted-foreground">
              Manage active sessions and security settings.
            </p>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
```

Update frontend/src/components/IncidentRow.tsx to use SwipeableRow on mobile:

Add imports:
```typescript
import { SwipeableRow } from './SwipeableRow';
import { useAcknowledgeIncident } from '@/hooks/useIncidentMutations';
```

Wrap the Card component with SwipeableRow:
```typescript
export function IncidentRow({
  incident,
  isSelected,
  isExpanded,
  onSelect,
  onToggleExpand,
  onShowOptions,
}: IncidentRowProps) {
  const acknowledgeMutation = useAcknowledgeIncident();

  const handleSwipeAcknowledge = () => {
    if (incident.status === 'OPEN') {
      acknowledgeMutation.mutate({ incidentId: incident.id });
    }
  };

  const rowContent = (
    <Card
      className={cn(
        'border-l-4 transition-all',
        borderClass,
        isExpanded && 'ring-2 ring-blue-500',
        'hover:shadow-md cursor-pointer'
      )}
      onClick={onToggleExpand}
    >
      {/* ... existing card content ... */}
    </Card>
  );

  return (
    <SwipeableRow
      onSwipeRight={incident.status === 'OPEN' ? handleSwipeAcknowledge : undefined}
      onSwipeLeft={onShowOptions}
      rightLabel="Acknowledge"
      leftLabel="Options"
      disabled={incident.status !== 'OPEN'}
    >
      {rowContent}
    </SwipeableRow>
  );
}
```

Update frontend/src/App.tsx to include all routes and MobileLayout:

```typescript
import { Routes, Route, Navigate } from 'react-router-dom';
import { usePWA } from './hooks/usePWA';
import { MobileLayout } from './components/MobileLayout';
import { OfflineIndicator } from './components/OfflineIndicator';
import DashboardPage from './pages/DashboardPage';
import IncidentDetailPage from './pages/IncidentDetailPage';
import SchedulePage from './pages/SchedulePage';
import ProfilePage from './pages/ProfilePage';

export default function App() {
  const { isOnline } = usePWA();

  return (
    <MobileLayout>
      <Routes>
        <Route path="/" element={<Navigate to="/incidents" replace />} />
        <Route path="/incidents" element={<DashboardPage />} />
        <Route path="/incidents/:id" element={<IncidentDetailPage />} />
        <Route path="/schedule" element={<SchedulePage />} />
        <Route path="/profile" element={<ProfilePage />} />
      </Routes>

      <OfflineIndicator isOnline={isOnline} />
    </MobileLayout>
  );
}
```
  </action>
  <verify>
ls frontend/src/components/MobileLayout.tsx
ls frontend/src/pages/SchedulePage.tsx
ls frontend/src/pages/ProfilePage.tsx
cd frontend && npm run build
  </verify>
  <done>
MobileLayout wraps app with bottom navigation. Schedule and Profile placeholder pages created. IncidentRow uses SwipeableRow for mobile swipe gestures. All routes configured.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npm run build` - Compiles without errors
2. Open in Chrome mobile emulation (DevTools -> Toggle device toolbar)
3. Verify bottom nav appears only on mobile viewport
4. Navigate between Incidents, Schedule, Profile tabs
5. On Incidents list, swipe right on OPEN incident - verify acknowledge
6. Swipe left - verify options preview appears
7. Test that vertical scroll still works (not blocked by swipe)
8. Resize to desktop - verify bottom nav disappears
</verification>

<success_criteria>
- [ ] Swipe gesture detects horizontal vs vertical movement
- [ ] Swipe right on OPEN incident triggers acknowledge
- [ ] Swipe left shows options preview
- [ ] Visual feedback (green/gray background) during swipe
- [ ] Vertical scroll not blocked by swipe gesture
- [ ] Bottom nav shows on mobile only
- [ ] Bottom nav has Incidents, Schedule, Profile tabs
- [ ] Active tab highlighted
- [ ] Schedule and Profile placeholder pages accessible
- [ ] Safe area padding for notched devices
</success_criteria>

<output>
After completion, create `.planning/phases/06-incident-management-dashboard**---web-and-mobile-ui-for-incident-response/06-08-SUMMARY.md`
</output>
