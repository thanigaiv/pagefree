# Milestone v1.1: Service Catalog

**Status:** ✅ SHIPPED 2026-02-08
**Phases:** 11-13
**Total Plans:** 6
**Total Tasks:** 14
**Commits:** 17 (16 feat + 1 fix)

## Overview

Centralize service ownership and alert routing through a comprehensive service catalog that serves as the single source of truth for the organization's technical ecosystem. Service-based routing replaces team-based routing with backward compatibility.

## Phases

### Phase 11: Service Model Foundation

**Goal**: Users can create and manage technical services with team ownership, lifecycle states, and optional escalation policy overrides
**Depends on**: Phase 10 (v1.0 complete)
**Requirements**: SVC-01, SVC-02, SVC-03, SVC-04, SVC-05, SVC-06
**Plans**: 2 plans

**Success Criteria** (what must be TRUE):
1. User can create a technical service with name, description, routing key, and owning team
2. User can edit service metadata (name, description, tags) after creation
3. User can archive or deprecate a service and see its lifecycle state reflected in the directory
4. User can browse service directory and filter by team, status, or search term
5. Service creation fails if no owning team is specified (required field)

Plans:
- [x] 11-01-PLAN.md — Backend: Prisma schema, service layer, REST routes for Service CRUD
- [x] 11-02-PLAN.md — Frontend: React Query hooks, types, ServicesPage with filtering and CRUD dialogs

### Phase 12: Service Dependencies & Graph

**Goal**: Users can model service dependencies and visualize upstream/downstream relationships with cycle detection preventing invalid configurations
**Depends on**: Phase 11
**Requirements**: DEP-01, DEP-02, DEP-03, DEP-04, DEP-05, DEP-06
**Plans**: 2 plans

**Success Criteria** (what must be TRUE):
1. User can add a dependency relationship between two services
2. User can remove an existing dependency relationship
3. System rejects dependency creation that would form a cycle (error displayed to user)
4. User can view a visual dependency graph showing service relationships
5. User can see upstream dependencies (what this service depends on) and downstream dependents (what depends on this service) separately

Plans:
- [x] 12-01-PLAN.md — Backend: Prisma schema extension, service-dependency.service.ts with cycle detection, REST endpoints
- [x] 12-02-PLAN.md — Frontend: React Query hooks, DependencyGraph component, ServicesPage with dependency management UI

### Phase 13: Service-Based Alert Routing

**Goal**: Alerts route to teams via service routing keys, with backward-compatible fallback to existing TeamTag routing for integrations not yet configured with services
**Depends on**: Phase 12
**Requirements**: ROUTE-01, ROUTE-02, ROUTE-03, ROUTE-04, ROUTE-05
**Plans**: 2 plans

**Success Criteria** (what must be TRUE):
1. Alert with routing_key in payload routes to the matching service's owning team
2. Alert without routing_key (or unmatched) falls back to existing TeamTag routing (no breakage)
3. Incident created via service routing shows linked service on incident detail page
4. Integration can specify a default service for alerts that arrive without explicit routing_key
5. Service-level escalation policy takes precedence over team default policy when configured

Plans:
- [x] 13-01-PLAN.md — Backend: Schema extensions (serviceId, defaultServiceId), routing service with service-first logic
- [x] 13-02-PLAN.md — Frontend: Incident detail service display, integration default service selector

---

## Milestone Summary

**Accomplishments:**
1. Service catalog foundation with CRUD operations, team ownership, lifecycle states (ACTIVE/DEPRECATED/ARCHIVED), and optional escalation policy overrides
2. Service dependency graph with DFS-based cycle detection, recursive CTE for graph queries, and React Flow + dagre visualization
3. Service-based alert routing with three-tier routing (routing_key → integration default → TeamTag fallback)
4. Backward compatibility preserved - legacy TeamTag routing and incidents without service display correctly
5. Complete service integration UI with service badges on incident details and default service selector in integration forms
6. Admin dashboard navigation card for service catalog accessibility

**Key Decisions:**
- Service routing with team-based fallback for backward compatibility
- PostgreSQL sufficient for dependency graphs (no graph DB needed)
- Cycle detection on every dependency create/update
- React Flow + dagre for dependency visualization (already installed)
- Platform admin only for service creation; team admin can update owned services
- Routing key regex: alphanumeric, underscores, hyphens only
- Status filter defaults to ACTIVE in UI to show relevant services first
- Routing key cannot be changed after service creation (UI enforces this)
- Implicit Prisma join table (_ServiceDependency) instead of explicit model
- DFS traversal for cycle detection (O(V+E) complexity)
- Recursive CTE with depth limit (max 20) for bounded graph queries
- Edges represent A depends on B (A->B direction)
- Left-to-right graph layout for dependency visualization
- Nested dialog pattern for add dependency flow
- Graph view requires service selection first
- ARCHIVED services skipped for routing
- Service escalation policy checked for isActive before use
- Service display renders only when incident.service exists (graceful legacy handling)
- Edit dialog pattern for integration settings (consistent with create dialog)
- Default service dropdown shows only ACTIVE services with team name

**Statistics:**
- Phases: 3 (11-13)
- Plans: 6 total
- Tasks: 14 total
- Files modified: 39 files (+6,256 insertions, -45 deletions)
- Lines of code: ~62,000 TypeScript (total codebase)
- Timeline: Same day execution (~1.5 hours)
- Git range: feat(11-01) → fix(admin-nav)

**UAT Results:**
- Phase 13 UAT: 6/7 tests passed
- 1 environmental issue (backend not running) - resolved
- No code defects found

**Issues Deferred:**
- AUTO-06 (runbook automation) deferred for security review (from v1.0)
- 10 failing Phase 2 webhook tests (regression from Phase 4, carried from v1.0)
- PWA icons are SVG placeholders (carried from v1.0)

**Technical Debt Incurred:**
- None - milestone shipped with full feature completeness

---

_For current project status, see .planning/ROADMAP.md_
